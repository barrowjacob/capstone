<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:insert="partials/mapbox_fragments :: head('Single Place Page')">
</head>


<body>
<nav th:insert="partials/fragments :: nav" class="is-blue"></nav>
<form th:action="@{'/places/create'}" method="POST" th:object="${place}">
    <label for="title">Title: </label>
    <input id="title" th:field="*{title}" type="text"/>
    <br />
    <label for="description">Description:</label>
    <input id="description" th:field="*{description}" />
    <br />
    <label for="cost_per_day">Cost per day: </label>
    <input id="cost_per_day" th:field="*{cost_per_day}" />

    <br />

    <label for="address">Address</label>
    <input id="address" th:field="*{address}" placeholder="Street, city, state, zip" required />
    <br />

    <div id="map"></div>
    <button class="button is-small is-success is-outlined">SUBMIT</button>

</form>


<footer th:insert="partials/mapbox_fragments :: mapbox_scripts"></footer>

<script>
$(document).ready(function(){


    function geocode(search, token) {
        const baseUrl = 'https://api.mapbox.com';
        const endPoint = '/geocoding/v5/mapbox.places/';
        return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
            .then(function(res) {
                return res.json();
                // to get all the data from the request, comment out the following three lines...
            }).then(function(data) {
                return data.features[0].center;
            });
    }

    mapboxgl.accessToken = mapBoxToken;

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-98.4936, 29.4241],
        zoom: 12,
    });

    const markerDetails = {
        color: 'orange',
        draggable: true
    };

    const marker = new mapboxgl.Marker(markerDetails)
        .setLngLat([-98.4936, 29.4241])
        .addTo(map);

    const geocoder = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken,
    });

    map.addControl(geocoder);

    var address = $('#address').val();

    geocode(address, mapBoxToken)
        .then(function (result) {
            map.flyTo({ center:result});
            marker.setLngLat(result);

        });

});

</script>
</body>
</html>