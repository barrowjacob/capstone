<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:insert="partials/fragments :: head('Profile Page')">
</head>
<body style="background-color: #FEEBCD">

<nav th:insert="partials/fragments :: nav" class="is-blue"></nav>

<div class="hero is-small"
     style="background-image: url('img/adventure-bg.jpg'); background-position: center; margin-top: 4%;">
   <div class="hero-body">
      <div
        style="display: flex; flex-direction: column; width: 400px; border-radius: 15%;">
         <div style="display: flex; align-items: center; margin-bottom: 1%;">
            <img th:if="${user.image_path == null}" src="img/user.jpg" style="border-radius: 50%; border: solid white 4px;
               width: 300px; background-position: center;">
            <img th:if="${user.image_path != null}" th:src="${user.image_path}" style="border-radius: 50%; border: solid white 4px;
               width: 300px; background-position: center;">
            <strong th:text="${user.username}"
                    class="has-text-light"
                    style="font-size: 50px; margin-left: 5%;"></strong>
         </div>
         <div>
            <div th:if="${loggedInUser != null && loggedInUser.id == user.id}">
               <form id="profImage" th:action="@{'/profile/' + ${user.id}}"
                     th:method="POST"
                     style="display: flex; justify-content: center; width: 70%;">
                  <button id="upload" class="button is-small"
                          style="background-color: #D0F2C2;border-radius: 15%; margin-right: 1%;"
                          type="button">Upload Image
                  </button>
                  <button id="submit"
                          class="button is-dark is-small"
                          style="border-radius: 15%;">
                     Submit
                  </button>
                  <div id="image">
                  </div>
               </form>
            </div>
         </div>
      </div>
   </div>
</div>

<div class="columns"
     style="height: 100%; margin-top: 1%;">
   <div class="container card column is-8"
        style="border-radius: 3%; display: flex; justify-content: center; align-items: center; flex-direction: column;">
      <div class="column is-4 is-offset-1">
         <h2 th:if="${userPlaces.size() > 0}" class="is-size-2" style="width: 100%;" th:text="${user.username} + '\'s Listings'"></h2>
      </div>
      <div class="column is-12"
           style="display: flex; justify-content: center; flex-wrap: wrap;">
         <div th:if="${userPlaces.size() > 0}" th:each="place : ${userPlaces}" style=" margin: 0 3% 3% 3%;">
            <a th:href="@{'/place/' + ${place.id}}">
               <div class="card"
                    style="max-height: 150px; width: 200px;">
                  <div class="card-image">
                     <div th:each="item,iStat : ${place.placeImages}">
                        <img th:if="${iStat.first}" th:src="${item.imagePath}"
                             style="height: 100px; width: 200px; ">
                     </div>
                  </div>
                  <div class="card-header"
                       style="display: flex; justify-content: center; white-space: nowrap; overflow: hidden;">
                     <span th:text="${place.title}"></span>
                  </div>
                     <div style="display: flex; justify-content: space-evenly;" th:if="${loggedInUser.id == user.id}" >
                        <form
                          th:action="@{'/places/' + ${place.id} + '/update'}"
                          method="GET">
                           <button class="button is-small is-success"><i
                             class="fas fa-wrench"></i></button>
                        </form>
                        <form
                          th:action="@{'/places/' + ${place.id} + '/delete'}"
                          method="POST">
                           <button class="button is-small is-danger"><i
                             class="fas fa-trash"></i></button>
                        </form>
                     </div>
               </div>
            </a>
         </div>
      </div>
      <div th:if="${userPlaces.size() < 1}" style="padding-bottom: 2%; display: flex; justify-content: center; width: 45%;">
         <h1 class="is-size-3">You don't have any listings yet! To add one, click <a href="/places/create">here</a></h1>
         </div>
      </div>
   </div>
</div>

<footer th:insert="partials/fragments :: footer"></footer>

<!--begin scripts-->

<script type="text/javascript" src="/static/js/keys.js"></script>
<script type="text/javascript"
        src="//static.filestackapi.com/filestack-js/3.x.x/filestack.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.js"
        integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
        crossorigin="anonymous"></script>
<script>
    $(document).ready(function () {
        const client = filestack.init("ArvmOJdHSwmo1NtHoPmi5z");
        const options = {
            onUploadDone: (res) => {
                $('#image').append(`<input type="hidden" name="image_path" value="https://cdn.filestackcontent.com/${res.filesUploaded[0].handle}">`);
            }
        };
        $("#upload").click(function () {
            client.picker(options).open();
        });
    });
</script>
</body>
</html>